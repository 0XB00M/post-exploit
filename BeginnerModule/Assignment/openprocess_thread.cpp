#include <stdio.h>
#include <windows.h>
#include <winternl.h>


int open_P_T(void) {

	PEB pInfo = { 0 };
	DWORD PID, TID = 1 ;
	PID = 12604;
	TID = 1984;

	if (pInfo.BeingDebugged) {
		printf("[!] Stopped debugging me \n");
	}
	else {
		printf("[!] No one debugging me \n");
	}

	printf("[#] Try opening the process \n");
	HANDLE hProcess = OpenProcess(
		PROCESS_ALL_ACCESS,
		FALSE,
		PID
	);

	printf("[#] Try opening the thread \n");
	HANDLE hThread = OpenThread(
		THREAD_ALL_ACCESS,
		FALSE,
		TID
	);


	if (hProcess == NULL) {
		printf("[!] Can not open a process \n");
		printf("[!] Error: %ld \n", GetLastError());
		CloseHandle(hProcess);
		CloseHandle(hThread);
		return EXIT_FAILURE;
	}

	printf("[#] Open process: %d \n", PID);
	printf("[#] Open thread: %d \n", TID);

	CloseHandle(hProcess);
	CloseHandle(hThread);

	return 0;
}
